window.app.module["/index"]=function(){function e(e){return document.getElementById(e)}function t(){$(".toggler").on("click",function(t){var a,n=e(this.getAttribute("data-toggle"));$(n).find("input").eq(0).val("");var i=window.getComputedStyle(n,null).getPropertyValue("display");i="none"===i?"block":"none",(a=e(this.getAttribute("data-toggleb")))&&(a.style.display="none"===i?"block":"none",e("buy-submit").innerHTML='<img src="/asset/img/auto.png">'===e("buy-submit").innerHTML?'<img src="/asset/img/manual.png">':'<img src="/asset/img/auto.png">',e("buy-submit").style.display=i,"day"===v.selected&&(e("buy-submit").style.display="block")),n.style.display=i})}function a(){var t;(t=getCookie("user_url"))&&(e("userLink").value=t)}function n(e){window.scrollTo(0,0),i(e,"#ff0000","highlight 2s ease-in-out infinite"),setTimeout(function(){i(e,"#ccc","none")},2e3)}function i(e,t,a){for(var n=0;n<e.length;n++)e[n].dom.style.borderColor=t,e[n].dom.style.animation=a}function s(){g.cache=[],g.add(e("userLink"),["empty","link"]),g.add(e("userKey"),["key"])}function l(e,t){var a,n;switch(e){case"addUser":a="user",n="POST";break;case"getUser":a="user",n="GET"}"weixin"===window.pingxx.browserType&&(t.open_id=window.pingxx.open_id);var i=new Date;$.ajax({url:"/api/"+a,type:n,data:t}).done(function(){ui.modal("任务正在执行中,请稍候"),h(t.url,i)}).fail(function(){ui.modal("操作失败,请重试")})}function p(){var t={url:e("userLink").value,channel:v.channel,type:v.selected,time:v.time};v.requestTime=new Date,"weixin"===window.pingxx.browserType&&(t.open_id=window.pingxx.openId),$.ajax({url:"/api/buy/url",type:"GET",data:t}).done(function(e){"success"===e.state&&(v.chargeId=e.data.charge.id,"alipay_qr"===v.channel||"wx_pub_qr"===v.channel?o(e.data.qr):pingpp.createPayment(e.data.charge,function(e,t){"success"==e?ui.modal("微信支付成功"):"fail"==e&&ui.modal("微信支付失败")}),c())}).fail(function(e){ui.modal("操作失败,请重试")})}function o(e){var t='<img class="qr-img" src="'+e+'">';f({tpl:t,showBtn:!1,title:"扫码支付"})}function c(t){var a=0,n=null,i=function(){a++,n=a%5===0?{force:1}:null,$.ajax({url:"/api/retrieve/"+v.chargeId,type:"GET",data:n}).done(function(t){"success"===t.state?(ui.modal("订单支付成功"),h(e("userLink").value,v.requestTime)):"订单支付超时"===t.message&&(ui.modal("订单支付超时,请重试"),clearInterval(s))}).fail(function(){ui.modal("获取支付结果失败,请联系客服"),clearInterval(s)})},s=setInterval(i,1e3)}function u(e){var t;return t=y.is_vip?new Date(y.vip_expire_at.replace(/-/g,"/")):new Date,t.setDate(t.getDate()+e),+t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}function d(e){for(var t=[{param:1,desc:"天"},{param:7,desc:"周"},{param:31,desc:"月"},{param:365,desc:"年"}],a=t.length-1;a>=0;a--)if(e%t[a].param===0)return+e/t[a].param+t[a].desc}function r(e){$.ajax({url:"/api/key",type:"GET",data:{key:e}}).done(function(e){if("success"===e.state)if(e.data.is_used)ui.modal("已使用过的激活码,请更换激活码");else{var t='<p><span class="item-title">激活码:&emsp;</span>'+e.data.key+'</p><p><span class="item-title">有效期:&emsp;</span>'+d(e.data.day)+"</p><p><span>使用成功以后,您的VIP到期时间为:"+u(e.data.day)+"</span></p>";f({tpl:t,title:"操作提示",showBtn:!0})}}).fail(function(e){404===e.status&&ui.modal("不存在的激活码")})}function m(){$.ajax({url:"/api/user",type:"GET",data:{url:e("userLink").value}}).done(function(t){"success"===t.state?(y=t.data,r(e("userKey").value)):ui.modal("你输入的邀请链接有错误")}).fail(function(){ui.modal("你输入的邀请链接有错误")})}function h(t,a){function n(){$.ajax({url:"/api/user",type:"GET",data:{url:t}}).done(function(e){if("success"===e.state){var t="";e.data.updated_at=e.data.updated_at?e.data.updated_at:"1970-01-22 12:22:22";var n=new Date(e.data.updated_at.replace(/-/g,"/"));n-a>=0&&(t+=e.data.is_vip?new Date(e.data.vip_expire_at.replace(/-/g,"/"))-new Date("2030/01/01 00:00:00")>0?"<p>您是永久VIP用户</p>":"<p>您是VIP用户,VIP到期时间:&emsp;"+e.data.vip_expire_at+"</p>":null!==e.data.vip_expire_at?"<p>您的VIP服务已过期</p>":"<p>您还不是VIP用户,处于手动刷棒棒糖模式</p>",t+='<p><span class="item-title">玩家名:&emsp;</span><span class="item-detail">'+e.data.username+"</span></p>",t+=e.data.today>4?'<p><span class="item-title">今日已刷(上限):&emsp;</span><span class="item-detail">'+e.data.today+"</span></p>":'<p><span class="item-title">今日已刷:&emsp;</span><span class="item-detail">'+e.data.today+"</span></p>",t+=e.data.tswk>19?'<p><span class="item-title">本周已刷(上限):&emsp;</span><span class="item-detail">'+e.data.tswk+"</span></p>":'<p><span class="item-title">本周已刷:&emsp;</span><span class="item-detail">'+e.data.tswk+"</span></p>",t+='<p><span class="item-title">代刷总数:&emsp;</span><span class="item-detail">'+e.data.touch_total+'</span></p><p><span class="item-title">赚糖总数:&emsp;</span><span class="item-detail">'+e.data.pop_total+"</span></p>",f({showBtn:!1,title:"操作结果",tpl:t}),clearInterval(i))}}).fail(function(){ui.modal("操作失败,请重试"),clearInterval(i)})}setCookie("user_url",e("userLink").value,7);var i=setInterval(n,2e3)}var y=null,f=function(e){$(".prompt-wrap").remove();var t,a;t=document.createElement("div"),t.setAttribute("class","prompt-wrap"),a=document.createElement("div"),a.setAttribute("class","prompt-body");var n=document.createElement("div");n.setAttribute("class","prompt-header"),n.innerHTML='<p class="prompt-title">使用提示</p><div id="cancelUse" class="prompt-close"></div>';var i=document.createElement("div");i.setAttribute("class","prompt-footer"),i.innerHTML='<div class="input-group"><a class="btn" href="javascript:;" id="comfirmUse">确认使用</a></div>',t.appendChild(n),t.appendChild(a),t.appendChild(i),document.body.appendChild(t),$("#comfirmUse").on("click",function(){l("addUser",{url:document.getElementById("userLink").value,key:document.getElementById("userKey").value}),$(t).fadeOut()}),$("#cancelUse").on("click",function(){$(t).fadeOut(),document.getElementById("userKey").value=null}),e.title&&$(".prompt-header .prompt-title").html(e.title),e.showBtn?$("#comfirmUse").show():$("#comfirmUse").hide(),a.innerHTML=e.tpl,$(t).fadeIn()},g={rules:{empty:function(e){return""!==e},link:function(e){return/^(http\:\/\/)?t\.cn\/[a-zA-Z0-9]+/.test(e)},key:function(e){return""===e||/^[0-9A-Z]{16}$/.test(e)}},cache:[],result:[],add:function(e,t){var a=this;this.cache.push(function(){for(var n=0;n<t.length;n++)if(!a.rules[t[n]](e.value))return void a.result.push({dom:e,error:t[n]})})},start:function(){this.result=[];for(var e=0;e<this.cache.length;e++)this.cache[e]();return this.result}},v={selected:null,types:[],btnWrap:null,time:1,price:0,channel:null,chargeId:null,requestTime:null,setChannel:function(e){["alipay_qr","wx_pub_qr","wx_pub"].indexOf(e)<0||(this.channel=e)},setPrice:function(t){var a={day:"免费",week:30,month:90,year:230};"day"===t?(e("price-block").style.display="none",e("payment-block").style.display="none",e("buy-submit").innerHTML='<img src="/asset/img/manual.png">',e("buy-submit").style.display="block"):(e("price-block").style.display="block",e("payment-block").style.display="block",e("buy-submit").style.display="none",this.price=a[this.selected]*this.time/100,e("buy-price").value="¥"+this.price)},listen:function(e){var t=this;this.btnWrap.find("a").length<1||this.btnWrap.on("click",function(e){var a=e.target;"img"===a.nodeName.toLowerCase()&&t.changeType(a.getAttribute("data-type"))})},highlight:function(e){for(var t=this.btnWrap.find("a"),a=0,n=t.length;a<n;++a)t.eq(a).attr("data-type")!==e?t.eq(a).removeClass("active"):t.eq(a).addClass("active")},changeType:function(e){this.selected=e,this.highlight(e),this.setPrice(e)},add:function(e){this.types.push(e)},reset:function(t){this.selected=t,this.setPrice(1),"day"===t?(e("price-block").style.display="none",e("payment-block").style.display="none"):(e("price-block").style.display="block",e("payment-block").style.display="block")},init:function(e,t){this.btnWrap=$("#"+t),e.apply(this),this.listen()}};scale=function(t,a,n,i,s){this.btn=document.getElementById(t),this.bar=document.getElementById(a),this.step=document.getElementById(n),this.valueBar=e(i),this.callback=s,this.init()},scale.prototype={init:function(){var e=this;e.btn.onmousedown=function(t){var a=(t||window.event).clientX,n=this.offsetLeft,i=e.bar.offsetWidth-this.offsetWidth;document.onmousemove=function(t){var s=(t||window.event).clientX,l=Math.min(i,Math.max(1,s-a+n));e.btn.style.left=l+"px",e.step.style.width=l+"px",e.ondrag(Math.max(0,l/i),l),window.getSelection?window.getSelection().removeAllRanges():document.selection.empty()},document.onmouseup=new Function("this.onmousemove=null")}},ondrag:function(e,t){this.callback.apply(this,arguments)},reset:function(){this.btn.style.left="1px",this.step.style.width="1px",this.valueBar.value="1"}},a(),"weixin"!==window.pingxx.browserType?$("#channel-mobile").hide():($("#channel-common").hide(),getCookie("open_id")?window.pingxx.openId=getCookie("open_id"):window.pingxx.getToken("open_id")?(setCookie("open_id",window.pingxx.getToken("open_id"),7),window.pingxx.openId=window.pingxx.getToken("open_id")):window.pingxx.getLogin("https://pop.gmcloud.io")),window.pingxx.getToken("has_key")&&$("#toggle-inputKey").show(),v.init(function(){this.changeType("week")},"choice-type"),ui.apiStatus(),s(),$("#followus").on("click",function(){var e='<img style="width:100%;max-width:300px;display:block;margin:0 auto;" src="/asset/img/gmcloud.png">';f({showBtn:!1,tpl:e,title:"微信公众号"})}),$("#buy-submit,.js-pay-submit").on("click",function(){$(this).hasClass("js-pay-submit")&&v.setChannel($(this).attr("data-channel"));var t=g.start();if(t.length>0)n(t);else{if(e("userKey").value)return void m();"day"===v.selected?l("addUser",{url:e("userLink").value}):p()}}),$("#query-by-url").on("click",function(){var t=g.start();t.length>0?n(t):(setCookie("user_url",e("userLink").value,7),$.ajax({url:"/api/user",type:"GET",data:{url:e("userLink").value}}).done(function(e){if("success"===e.state){var t="";t+=e.data.is_vip?new Date(e.data.vip_expire_at.replace(/-/g,"/"))-new Date("2030/01/01 00:00:00")>0?"<p>您是永久VIP用户</p>":"<p>您是VIP用户,VIP到期时间:&emsp;"+e.data.vip_expire_at+"</p>":null!==e.data.vip_expire_at?"<p>您的VIP服务已过期</p>":"<p>您还不是VIP用户,处于手动刷棒棒糖模式</p>",t+='<p><span class="item-title">玩家名:&emsp;</span><span class="item-detail">'+e.data.username+"</span></p>",t+=e.data.today>4?'<p><span class="item-title">今日已刷(上限):&emsp;</span><span class="item-detail">'+e.data.today+"</span></p>":'<p><span class="item-title">今日已刷:&emsp;</span><span class="item-detail">'+e.data.today+"</span></p>",t+=e.data.tswk>19?'<p><span class="item-title">本周已刷(上限):&emsp;</span><span class="item-detail">'+e.data.tswk+"</span></p>":'<p><span class="item-title">本周已刷:&emsp;</span><span class="item-detail">'+e.data.tswk+"</span></p>",t+='<p><span class="item-title">代刷总数:&emsp;</span><span class="item-detail">'+e.data.touch_total+'</span></p><p><span class="item-title">赚糖总数:&emsp;</span><span class="item-detail">'+e.data.pop_total+"</span></p>",f({showBtn:!1,title:"操作结果",tpl:t})}else ui.modal("你输入的邀请链接有错误")}).fail(function(){ui.modal("你输入的邀请链接有错误")}))}),t()};
