function getUrl(e){function n(e){var n={"/index":"main.js","/store":"store.js","/coupon":"coupon.js"};for(var t in window.app.router)t!==e&&document.body.removeChild(window.app.router[t]);if(e in window.app.router)document.body.appendChild(window.app.router[e]),window.app.module[e]();else{var o=document.createElement("script");o.src="/asset/script/"+n[e],document.body.appendChild(o),window.app.router[e]=o,window.app.router[e].onload=function(){window.app.module[e]()}}}$.ajax({url:e+".html",type:"GET"}).done(function(t){window._search=window.location.search||"",window.history.replaceState(e,"GMCloud",e),$("#ui-view").html(t),n(window.location.pathname)}).fail(function(){alert("请求失败,请重试")})}function diffScript(e){for(var n=document.getElementsByTagName("script"),t=new RegExp(e.slice(0,-3)+".js"),o=n.length-1;o>=0;o--)if(t.test(n[o].src))return!1;return!0}function setCookie(e,n,t){var o=new Date;o.setDate(o.getDate()+t),document.cookie=e+"="+escape(n)+(null==t?"":";expires="+o.toGMTString())}function getCookie(e){return document.cookie.length>0&&(c_start=document.cookie.indexOf(e+"="),c_start!=-1)?(c_start=c_start+e.length+1,c_end=document.cookie.indexOf(";",c_start),c_end==-1&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""}document.onreadystatechange=function(){if("interactive"===document.readyState){var e=window.location.pathname;"/"===window.location.pathname&&(e="index"),getUrl(e)}},window.app={router:{},module:{}},window.pingxx={openId:null,browserType:"common",getToken:function(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),t=window._search.substr(1).match(n);return null!==t?unescape(t[2]):null},getLogin:function(e){window.location.href="/api/login/wx_base?from="+e}},/micromessenger/.test(navigator.userAgent.toLowerCase())&&(window.pingxx.browserType="weixin"),window.ui={modal:function(){var e;return function(n){return e||(e=document.createElement("div"),e.setAttribute("class","modal-wrap"),document.body.appendChild(e)),tpl='<div class="modal"><span class="icon"></span><p class="text">'+n+"</p></div>",$(e).fadeIn(),e.innerHTML=tpl,setTimeout(function(){$(e).fadeOut()},2e3),e}}(),apiStatus:function(){$.ajax({url:"/api/stats",type:"GET"}).done(function(e){"success"===e.state&&(document.getElementById("api-status").innerHTML="<p>总共执行<span>"+e.data.touch+"次任务,</span></p><p>已为<span>"+e.data.user+"</span>位用户获取了<span>"+e.data.pop+"</span>个棒棒糖</p>")}).fail(function(){})}};
